/**
 * Theta Viewer v0.2
 *
 * Copyright Atsushi Kokubo
 * Released under the MIT license.
 *//*jslint browser:true, devel:true *//*global jQuery, THREE, requestAnimationFrame */(function(e){"use strict";var t="renderer",n=!0,r="width",i="height",s="scene",o="camera",u="image",a="geometry",f="Matrix4",l="applyMatrix",c=!1,h="updateProjectionMatrix",p="preventDefault",d="wheelDeltaY",v="wheelDelta",m="addEventListener",g="render",y="data",b=function(y,b,w,E,S,x){function T(s,o){s[t]=new THREE.WebGLRenderer({antialias:n}),s[t].setSize(o[r](),o[i]()),s[t].setClearColor(0,1),e(o).append(s[t].domElement)}function N(e){e[s]=new THREE.Scene}function C(e){var t=new THREE.AmbientLight(16777215);e[s].add(t)}function k(e){var t=72,n=y[r]()/y[i](),u=.1,a=1e3,f=(90-x)*Math.PI/180,l=S*Math.PI/180;e[o]=new THREE.PerspectiveCamera(t,n,u,a),e[o].lookAt({x:Math.sin(f)*Math.cos(l),y:Math.cos(f),z:Math.sin(f)*Math.sin(l)}),e[s].add(e[o])}function L(e,t,n,s){var o=1,c=32,h=16,p=0,d=2*Math.PI,v,m,g;m=2*Math.PI*t[u][i]/t[u][r],m>Math.PI&&(m=Math.PI),v=(Math.PI-m)/2,e[a]=new THREE.SphereGeometry(o,c,h,p,d,v,m),g=(new THREE[f]).makeScale(1,1,-1),e[a][l](g),g=(new THREE[f]).makeRotationZ(s*Math.PI/180),e[a][l](g),g=(new THREE[f]).makeRotationX(n*Math.PI/180),e[a][l](g)}function A(e,t){e.material=new THREE.MeshBasicMaterial({overdraw:n,map:t,side:THREE.FrontSide})}function O(e){e.mesh=new THREE.Mesh(e[a],e.material),e[s].add(e.mesh)}function M(s,u){function x(){E.aspect=u[r]()/u[i](),E[h](),S.setSize(u[r](),u[i]())}function T(e){e[p](),a=n,f=b,l=w,g=e.clientX,y=e.clientY}function N(e){var t,r;e[p](),a===n&&(b=(e.clientY-y)*.1+f,b=Math.max(-85,Math.min(85,b)),w=(g-e.clientX)*.1+l,t=(90-b)*Math.PI/180,r=w*Math.PI/180,E.lookAt({x:Math.sin(t)*Math.cos(r),y:Math.cos(t),z:Math.sin(t)*Math.sin(r)}))}function C(){a=c}function k(e){var t=E.fov,n=20,r=150;e[p](),e[d]?t-=e[d]*.05:e[v]?t-=e[v]*.05:e.detail&&(t+=e.detail),t<n&&(t=n),t>r&&(t=r),E.fov=t,E[h]()}var a=c,f=0,l=0,g=0,y=0,b=0,w=0,E=s[o],S=s[t];e(u).on("mousedown",T).on("mousemove",N).on("mouseup",C).on("mouseout",C).on("resize",x),e(u).get(0)[m]("mousewheel",k,c),e(u).get(0)[m]("DOMMouseScroll",k,c)}T(this,y),N(this),C(this),k(this),L(this,b,w,E),A(this,b),O(this),M(this,y),this[g]=function(e){return function(){requestAnimationFrame(e[g]),e[t][g](e[s],e[o])}}(this)};e.fn.createThetaViewer=function(){var e=this[y](u),t=this[y]("zenith-x")||0,n=this[y]("zenith-y")||0,r=this[y]("azimuth")||0,i=this[y]("elevation")||0,s,o,a=this,f=function(){var e=new b(a,s,t,n,r,i);e[g]()},l=function(){console.log("loading error: "+e)};return o=undefined,s=THREE.ImageUtils.loadTexture(e,o,f,l),this}})(jQuery);